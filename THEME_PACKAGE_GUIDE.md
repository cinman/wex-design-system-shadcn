# WEX Design Tokens - Package Creation Guide

This guide documents the complete process for creating and publishing the `@wex/design-tokens` NPM package from the WEX Design System.

---

## Overview

The `@wex/design-tokens` package provides design tokens (colors, spacing, typography, etc.) in multiple formats for consumption by any framework.

### Package Outputs

| Format | File | Purpose |
|--------|------|---------|
| CSS Variables | `dist/css/tokens.css` | Universal - works in any framework |
| shadcn Bridge | `dist/css/shadcn-bridge.css` | Maps WEX tokens to shadcn/Spartan variable names |
| TypeScript/ESM | `dist/js/tokens.js` + `tokens.d.ts` | Programmatic access with type safety |
| Tailwind Preset | `tailwind-preset.js` | Drop-in Tailwind configuration |
| JSON | `dist/json/tokens.json` | Raw token data for tooling |

---

## Prerequisites

Install Style Dictionary:

```bash
npm install -D style-dictionary
```

---

## Step 1: Convert Tokens to Style Dictionary Format

Style Dictionary uses JSON (or JS) as input. Convert the existing `wex.tokens.css` to JSON format.

### Source Token Structure

Create `tokens/` directory with organized token files:

```
tokens/
├── color/
│   ├── base.json        # Raw color values
│   ├── semantic.json    # Semantic color assignments
│   └── component.json   # Component-specific colors
├── spacing.json
├── typography.json
├── radius.json
├── shadow.json
└── animation.json
```

### Example: tokens/color/base.json

```json
{
  "color": {
    "base": {
      "white": { "value": "#ffffff" },
      "black": { "value": "#000000" },
      "blue": {
        "50": { "value": "#eff6ff" },
        "100": { "value": "#dbeafe" },
        "200": { "value": "#bfdbfe" },
        "300": { "value": "#93c5fd" },
        "400": { "value": "#60a5fa" },
        "500": { "value": "#3b82f6" },
        "600": { "value": "#2563eb" },
        "700": { "value": "#1d4ed8" },
        "800": { "value": "#1e40af" },
        "900": { "value": "#1e3a8a" },
        "950": { "value": "#172554" }
      }
    }
  }
}
```

### Example: tokens/color/semantic.json

```json
{
  "color": {
    "semantic": {
      "primary": {
        "value": "{color.base.blue.600}",
        "comment": "Primary brand color"
      },
      "primary-foreground": {
        "value": "{color.base.white}",
        "comment": "Text on primary backgrounds"
      },
      "destructive": {
        "value": "{color.base.red.600}",
        "comment": "Error and destructive actions"
      },
      "success": {
        "value": "{color.base.green.600}",
        "comment": "Success states"
      },
      "warning": {
        "value": "{color.base.amber.500}",
        "comment": "Warning states"
      },
      "info": {
        "value": "{color.base.blue.500}",
        "comment": "Informational states"
      }
    }
  }
}
```

### Example: tokens/spacing.json

```json
{
  "spacing": {
    "0": { "value": "0px" },
    "1": { "value": "4px" },
    "2": { "value": "8px" },
    "3": { "value": "12px" },
    "4": { "value": "16px" },
    "5": { "value": "20px" },
    "6": { "value": "24px" },
    "8": { "value": "32px" },
    "10": { "value": "40px" },
    "12": { "value": "48px" },
    "16": { "value": "64px" },
    "target": { 
      "value": "44px",
      "comment": "Minimum touch target size for accessibility"
    }
  }
}
```

### Example: tokens/radius.json

```json
{
  "radius": {
    "none": { "value": "0px" },
    "sm": { "value": "4px" },
    "md": { "value": "6px" },
    "lg": { "value": "8px" },
    "xl": { "value": "12px" },
    "2xl": { "value": "16px" },
    "full": { "value": "9999px" }
  }
}
```

---

## Step 2: Style Dictionary Configuration

Create `style-dictionary.config.js`:

```javascript
const StyleDictionary = require('style-dictionary');

// Custom format for TypeScript with const assertions
StyleDictionary.registerFormat({
  name: 'typescript/esm',
  formatter: function({ dictionary }) {
    const tokens = {};
    
    dictionary.allTokens.forEach(token => {
      const path = token.path;
      let current = tokens;
      
      for (let i = 0; i < path.length - 1; i++) {
        if (!current[path[i]]) {
          current[path[i]] = {};
        }
        current = current[path[i]];
      }
      
      current[path[path.length - 1]] = token.value;
    });
    
    return `// Auto-generated by Style Dictionary
// Do not edit directly

${Object.entries(tokens).map(([key, value]) => 
  `export const ${key} = ${JSON.stringify(value, null, 2)} as const;`
).join('\n\n')}

export type TokenValue = string | number;
export type TokenCategory = keyof typeof color | keyof typeof spacing | keyof typeof radius;
`;
  }
});

// Custom format for CSS custom properties with WEX prefix
StyleDictionary.registerFormat({
  name: 'css/wex-variables',
  formatter: function({ dictionary, options }) {
    const tokens = dictionary.allTokens
      .map(token => {
        const name = token.path.join('-');
        return `  --wex-${name}: ${token.value};`;
      })
      .join('\n');
    
    return `/* WEX Design Tokens - Auto-generated */
/* Do not edit directly */

:root {
${tokens}
}
`;
  }
});

module.exports = {
  source: ['tokens/**/*.json'],
  
  platforms: {
    // CSS Custom Properties
    css: {
      transformGroup: 'css',
      buildPath: 'dist/css/',
      files: [
        {
          destination: 'tokens.css',
          format: 'css/wex-variables',
        }
      ]
    },
    
    // TypeScript/ESM
    js: {
      transformGroup: 'js',
      buildPath: 'dist/js/',
      files: [
        {
          destination: 'tokens.js',
          format: 'typescript/esm',
        }
      ]
    },
    
    // JSON for tooling
    json: {
      transformGroup: 'js',
      buildPath: 'dist/json/',
      files: [
        {
          destination: 'tokens.json',
          format: 'json/nested',
        }
      ]
    }
  }
};
```

---

## Step 3: Create the shadcn Bridge

The shadcn-bridge.css file maps WEX tokens to shadcn/ui variable names. This file is maintained manually (not generated by Style Dictionary) because it represents semantic mappings.

**dist/css/shadcn-bridge.css**

```css
/* WEX to shadcn/ui Variable Bridge */
/* Maps WEX design tokens to shadcn component variable names */
/* This enables drop-in compatibility with shadcn/ui and Spartan UI */

:root {
  /* Background and foreground */
  --background: var(--wex-color-semantic-background);
  --foreground: var(--wex-color-semantic-foreground);
  
  /* Card */
  --card: var(--wex-color-semantic-card);
  --card-foreground: var(--wex-color-semantic-card-foreground);
  
  /* Popover */
  --popover: var(--wex-color-semantic-popover);
  --popover-foreground: var(--wex-color-semantic-popover-foreground);
  
  /* Primary */
  --primary: var(--wex-color-semantic-primary);
  --primary-foreground: var(--wex-color-semantic-primary-foreground);
  
  /* Secondary */
  --secondary: var(--wex-color-semantic-secondary);
  --secondary-foreground: var(--wex-color-semantic-secondary-foreground);
  
  /* Muted */
  --muted: var(--wex-color-semantic-muted);
  --muted-foreground: var(--wex-color-semantic-muted-foreground);
  
  /* Accent */
  --accent: var(--wex-color-semantic-accent);
  --accent-foreground: var(--wex-color-semantic-accent-foreground);
  
  /* Destructive */
  --destructive: var(--wex-color-semantic-destructive);
  --destructive-foreground: var(--wex-color-semantic-destructive-foreground);
  
  /* Semantic states */
  --success: var(--wex-color-semantic-success);
  --success-foreground: var(--wex-color-semantic-success-foreground);
  --warning: var(--wex-color-semantic-warning);
  --warning-foreground: var(--wex-color-semantic-warning-foreground);
  --info: var(--wex-color-semantic-info);
  --info-foreground: var(--wex-color-semantic-info-foreground);
  
  /* Border and input */
  --border: var(--wex-color-semantic-border);
  --input: var(--wex-color-semantic-input);
  --ring: var(--wex-color-semantic-ring);
  
  /* Radius */
  --radius: var(--wex-radius-md);
}

/* Dark mode overrides */
.dark {
  --background: var(--wex-color-semantic-background-dark);
  --foreground: var(--wex-color-semantic-foreground-dark);
  /* ... additional dark mode mappings ... */
}
```

---

## Step 4: Create Tailwind Preset

**tailwind-preset.js**

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  theme: {
    extend: {
      colors: {
        // Map to CSS variables for runtime theming
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        success: {
          DEFAULT: "hsl(var(--success))",
          foreground: "hsl(var(--success-foreground))",
        },
        warning: {
          DEFAULT: "hsl(var(--warning))",
          foreground: "hsl(var(--warning-foreground))",
        },
        info: {
          DEFAULT: "hsl(var(--info))",
          foreground: "hsl(var(--info-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      minHeight: {
        target: "44px", // Accessibility: minimum touch target
      },
      minWidth: {
        target: "44px",
      },
      fontFamily: {
        sans: ["var(--font-sans)", "system-ui", "sans-serif"],
        display: ["var(--font-display)", "system-ui", "sans-serif"],
        mono: ["var(--font-mono)", "monospace"],
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate")],
};
```

---

## Step 5: Package Structure

Create the package directory structure:

```
packages/design-tokens/
├── package.json
├── README.md
├── LICENSE
├── style-dictionary.config.js
├── tailwind-preset.js
├── tokens/                      # Source tokens
│   ├── color/
│   │   ├── base.json
│   │   ├── semantic.json
│   │   └── component.json
│   ├── spacing.json
│   ├── typography.json
│   ├── radius.json
│   ├── shadow.json
│   └── animation.json
├── static/                      # Non-generated files
│   └── shadcn-bridge.css
└── dist/                        # Generated outputs (gitignored)
    ├── css/
    │   ├── tokens.css
    │   └── shadcn-bridge.css   # Copied from static/
    ├── js/
    │   ├── tokens.js
    │   └── tokens.d.ts
    └── json/
        └── tokens.json
```

---

## Step 6: Package.json

**packages/design-tokens/package.json**

```json
{
  "name": "@wex/design-tokens",
  "version": "1.0.0",
  "description": "WEX Design System tokens - CSS variables, TypeScript, and Tailwind preset",
  "main": "dist/js/tokens.js",
  "module": "dist/js/tokens.js",
  "types": "dist/js/tokens.d.ts",
  "exports": {
    ".": {
      "import": "./dist/js/tokens.js",
      "require": "./dist/js/tokens.cjs",
      "types": "./dist/js/tokens.d.ts"
    },
    "./css": "./dist/css/tokens.css",
    "./css/tokens": "./dist/css/tokens.css",
    "./css/shadcn-bridge": "./dist/css/shadcn-bridge.css",
    "./tailwind-preset": "./tailwind-preset.js",
    "./json": "./dist/json/tokens.json"
  },
  "files": [
    "dist",
    "tailwind-preset.js",
    "README.md"
  ],
  "scripts": {
    "build": "style-dictionary build && npm run copy-static",
    "copy-static": "cp static/shadcn-bridge.css dist/css/",
    "clean": "rm -rf dist",
    "prepublishOnly": "npm run clean && npm run build"
  },
  "devDependencies": {
    "style-dictionary": "^3.9.0"
  },
  "peerDependencies": {
    "tailwindcss": ">=3.0.0"
  },
  "peerDependenciesMeta": {
    "tailwindcss": {
      "optional": true
    }
  },
  "keywords": [
    "wex",
    "design-system",
    "design-tokens",
    "css-variables",
    "tailwind",
    "theme"
  ],
  "author": "WEX Design System Team",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/wex/design-tokens.git"
  }
}
```

---

## Step 7: Build the Package

```bash
cd packages/design-tokens

# Install dependencies
npm install

# Build all outputs
npm run build
```

This generates:
- `dist/css/tokens.css` - CSS custom properties
- `dist/css/shadcn-bridge.css` - Copied from static/
- `dist/js/tokens.js` - ESM JavaScript
- `dist/js/tokens.d.ts` - TypeScript declarations
- `dist/json/tokens.json` - Raw JSON

---

## Step 8: Publishing

### Option A: Artifactory (Private)

1. **Configure .npmrc** for Artifactory:

```bash
# .npmrc in package root
@wex:registry=https://artifactory.wexinc.com/artifactory/api/npm/npm-local/
//artifactory.wexinc.com/artifactory/api/npm/npm-local/:_authToken=${ARTIFACTORY_TOKEN}
```

2. **Authenticate:**

```bash
# Set environment variable
export ARTIFACTORY_TOKEN=your-token-here

# Or use npm login
npm login --registry=https://artifactory.wexinc.com/artifactory/api/npm/npm-local/
```

3. **Publish:**

```bash
npm publish
```

### Option B: Private NPM (GitHub Packages)

1. **Configure .npmrc:**

```bash
# .npmrc
@wex:registry=https://npm.pkg.github.com
//npm.pkg.github.com/:_authToken=${GITHUB_TOKEN}
```

2. **Update package.json repository field:**

```json
{
  "repository": {
    "type": "git",
    "url": "https://github.com/wex-inc/design-tokens.git"
  },
  "publishConfig": {
    "@wex:registry": "https://npm.pkg.github.com"
  }
}
```

3. **Publish:**

```bash
npm publish
```

---

## Consumer Usage

### React (with shadcn/ui)

**1. Install:**

```bash
npm install @wex/design-tokens
```

**2. Import CSS (in global stylesheet or entry point):**

```css
/* styles/globals.css */
@import "@wex/design-tokens/css/tokens";
@import "@wex/design-tokens/css/shadcn-bridge";

@tailwind base;
@tailwind components;
@tailwind utilities;
```

**3. Configure Tailwind:**

```javascript
// tailwind.config.js
const wexPreset = require("@wex/design-tokens/tailwind-preset");

module.exports = {
  presets: [wexPreset],
  content: ["./src/**/*.{js,ts,jsx,tsx}"],
};
```

**4. Done!** shadcn components now use WEX colors.

---

### Angular (with Spartan UI)

**1. Install:**

```bash
npm install @wex/design-tokens
```

**2. Import CSS (in angular.json):**

```json
{
  "styles": [
    "node_modules/@wex/design-tokens/dist/css/tokens.css",
    "node_modules/@wex/design-tokens/dist/css/shadcn-bridge.css",
    "src/styles.scss"
  ]
}
```

**3. Configure Tailwind:**

```javascript
// tailwind.config.js
const wexPreset = require("@wex/design-tokens/tailwind-preset");

module.exports = {
  presets: [wexPreset],
  content: ["./src/**/*.{html,ts}"],
};
```

**4. Done!** Spartan components now use WEX colors.

---

### Programmatic Access (TypeScript)

```typescript
import { color, spacing, radius } from "@wex/design-tokens";

// Type-safe token access
const primaryColor = color.semantic.primary; // "var(--wex-color-semantic-primary)"
const targetSize = spacing.target; // "44px"

// Use in dynamic styles
const buttonStyle = {
  backgroundColor: primaryColor,
  minHeight: targetSize,
};
```

---

## Versioning Strategy

Follow semantic versioning:

| Change Type | Version Bump | Example |
|-------------|--------------|---------|
| New tokens added | Minor | 1.0.0 → 1.1.0 |
| Token value changed | Patch | 1.0.0 → 1.0.1 |
| Token renamed/removed | Major | 1.0.0 → 2.0.0 |
| Breaking structure change | Major | 1.0.0 → 2.0.0 |

---

## CI/CD Integration

### GitHub Actions Example

**.github/workflows/publish.yml**

```yaml
name: Publish Design Tokens

on:
  push:
    tags:
      - 'v*'

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          registry-url: 'https://npm.pkg.github.com'
      
      - name: Install dependencies
        run: npm ci
        working-directory: packages/design-tokens
      
      - name: Build
        run: npm run build
        working-directory: packages/design-tokens
      
      - name: Publish
        run: npm publish
        working-directory: packages/design-tokens
        env:
          NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

---

## Checklist

Before publishing:

- [ ] All token files are valid JSON
- [ ] `npm run build` succeeds
- [ ] `dist/` contains all expected files
- [ ] `tailwind-preset.js` exports correctly
- [ ] `shadcn-bridge.css` maps all required variables
- [ ] Package version bumped appropriately
- [ ] README updated if API changed
- [ ] Tested in consumer project (React and/or Angular)

---

## Troubleshooting

### "Cannot find module '@wex/design-tokens'"

Ensure the package is installed and your `.npmrc` is configured for the private registry.

### Tailwind colors not applying

1. Check that CSS files are imported before Tailwind directives
2. Verify `tailwind.config.js` includes the preset
3. Ensure content paths include your component files

### TypeScript types not working

Add to `tsconfig.json`:

```json
{
  "compilerOptions": {
    "moduleResolution": "bundler",
    "types": ["@wex/design-tokens"]
  }
}
```

---

## Questions?

Contact the Design System Team for assistance with package creation or publishing.

